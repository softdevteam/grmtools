<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Start States - grmtools</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">grmtools</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="start-states"><a class="header" href="#start-states">Start States</a></h1>
<p>The following explains the syntax and semantics of Start States in lrlex.<br>
A working example can be found in the repository at <a href="https://github.com/softdevteam/grmtools/tree/master/lrpar/examples/start_states">lrpar/examples/start_states</a></p>
<h2 id="motivation"><a class="header" href="#motivation">Motivation</a></h2>
<p>Start states are a feature from lex which can be used for context sensitive lexing.
For instance, they can be used to implement nested comments (see the example in the repository).
Such that the tokens start/end markers of tokens maintain balance.</p>
<p>This is achieved by making rules which are qualified to match only when the lexer is in a
particular state. Additionally the lexer has a stack of states, and matching rules perform actions
which modify the stack.</p>
<h2 id="the-initial-start-state"><a class="header" href="#the-initial-start-state">The INITIAL start state</a></h2>
<p>Unless specified otherwise all lex rules are members of the <em>INITIAL</em> start state.</p>
<pre><code>%%
&lt;INITIAL&gt;a "A"
&lt;INITIAL&gt;[\t \n]+ ;
</code></pre>
<p>This is the lex file below with no start states specified.</p>
<pre><code>%%
a "A"
[\t \n]+ ;
</code></pre>
<h2 id="rules-matching-multiple-states"><a class="header" href="#rules-matching-multiple-states">Rules matching multiple states</a></h2>
<p>Rules can be matched in multiple states, just separate the states a rule should match in commas.
The following matches the <code>a</code> character when in either of the states <code>FirstState</code> or <code>SecondState</code>.</p>
<pre><code>&lt;FirstState,SecondState&gt;a "A"
</code></pre>
<h2 id="differences-from-posix-lex"><a class="header" href="#differences-from-posix-lex">Differences from POSIX lex</a></h2>
<p>In posix lex start states are entered via code in the action, through either <code>BEGIN(STATE)</code> and
calling combinations of <code>yy_push_state</code>, and <code>yy_pop_state</code>.</p>
<p>Because lrlex is actionless, and does not support code actions, instead we have operators to
perform the common modifications to the stack of start states.</p>
<h3 id="push"><a class="header" href="#push">Push</a></h3>
<p>The push operator is given by the adding '+' to the target state on the right hand side within
angle brackets. The following when regex matches in the <em>CURRENT_STATE</em> pushes <em>TARGET_STATE</em> to
the top of a stack of states.</p>
<pre><code>&lt;CURRENT_STATE&gt;Regex &lt;+TARGET_STATE&gt;;
</code></pre>
<h3 id="pop"><a class="header" href="#pop">Pop</a></h3>
<p>The pop operator is given by the adding '-' to the target state on the right hand side within angle
brackets. Similarly when in the current state, the following pops the current state off of the
stack of states. Similarly to calling <code>yy_pop_state</code> from action code.</p>
<pre><code>&lt;CURRENT_STATE&gt;Regex &lt;-CURRENT_STATE&gt;;
</code></pre>
<h3 id="replacestack"><a class="header" href="#replacestack">ReplaceStack</a></h3>
<p>The ReplaceStack operator is given by naming the target state within angle brackets.
The ReplaceStack op clears the entire stack of states, then pushing the target state.</p>
<pre><code>&lt;CURRENT_STATE&gt;Regex &lt;TARGET_STATE&gt;;
</code></pre>
<h3 id="returning-a-token-while-performing-an-operator"><a class="header" href="#returning-a-token-while-performing-an-operator">Returning a token while performing an operator.</a></h3>
<p>Start state operators can be combined with returning a token for example:</p>
<pre><code>&lt;CURRENT_STATE&gt;Regex &lt;+TARGET_STATE&gt;"TOKEN"
</code></pre>
<h2 id="adding-a-start-state"><a class="header" href="#adding-a-start-state">Adding a start state</a></h2>
<p>Start stats come in two forms, <em>exclusive</em> and <em>inclusive</em>. These are given by <code>%x</code> and <code>%s</code>
respectively.</p>
<h3 id="exclusive-states"><a class="header" href="#exclusive-states">Exclusive states</a></h3>
<p>In an exclusive state, the rule can be matched <em>only</em> if the rule begins with the state specified.
In the following because <code>ExclState</code> is <em>exclusive</em>, the <code>#=</code> rule is only matched during the
<code>INITIAL</code> state, while the <code>a</code> and <code>=#</code> characters are only matched while in the <code>ExclState</code>.</p>
<pre><code>%x ExclState
%%

#= &lt;+ExclState&gt;;
&lt;ExclState&gt;a "A"
&lt;ExclState&gt;=# &lt;-ExclState&gt;;
</code></pre>
<h3 id="inclusive-states"><a class="header" href="#inclusive-states">Inclusive states</a></h3>
<p>Inclusive states are added to the set of rules to be matched when the start state is unspecified.</p>
<pre><code>%s InclusiveState
%%

a "A"
&lt;InclusiveState&gt;b "B"
&lt;INITIAL&gt;#= &lt;+InclusiveState&gt;;
&lt;InclusiveState&gt;=# &lt;-InclusiveState&gt;;
</code></pre>
<p>Is equivalent to the following using exclusive states.</p>
<pre><code>%x Excl
%%

&lt;INITIAL, Excl&gt;a "A"
&lt;Excl&gt;b "B"
&lt;INITIAL&gt;#= &lt;+Excl&gt;;
&lt;Excl&gt;=# &lt;-Excl&gt;;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="manuallexer.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="parsing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="manuallexer.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="parsing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
